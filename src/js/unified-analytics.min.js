!function(){const e=new class{constructor(e={}){this.gaId=e.gaId||window.CONFIG&&window.CONFIG.ANALYTICS_ID||"G-506106497",this.endpoint=e.endpoint||"/api/analytics",this.debug=e.debug||!1,this.sessionId=this.generateSessionId(),this.providers={ga:!1,vercel:!1,local:!1},this.consent={necessary:!0,analytics:!1,thirdParty:!1},this.eventQueue=[],this.initializeLocalTracker(),this.loadStoredConsent(),window.analytics=this}generateSessionId(){return`s_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,7)}`}initializeLocalTracker(){if((window.CONFIG?.ENABLE_LOCAL_ANALYTICS||!this.debug)&&void 0!==window.AnalyticsTracker)try{this.localTracker=new window.AnalyticsTracker({endpoint:this.endpoint,debug:this.debug}),this.providers.local=!0,this.debug&&console.debug("Local AnalyticsTracker initialized")}catch(e){this.debug&&console.debug("Failed to initialize local tracker:",e)}}loadStoredConsent(){try{const e=localStorage.getItem("cs-learning-consent");if(e){const t=JSON.parse(e);this.setConsent(t)}}catch(e){this.debug&&console.debug("Failed to load stored consent:",e)}}setConsent(e){if(!e||"object"!=typeof e)return;const t={...this.consent};this.consent={...this.consent,...e},this.consent.analytics&&!t.analytics&&(this.loadGoogleAnalytics(),this.processEventQueue()),this.consent.thirdParty&&!t.thirdParty&&this.loadVercelAnalytics(),!this.consent.analytics&&t.analytics&&(this.eventQueue=[])}loadGoogleAnalytics(){if(!this.providers.ga&&this.gaId)try{window.dataLayer=window.dataLayer||[],window.gtag=window.gtag||function(){window.dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config",this.gaId,{send_page_view:!1,session_id:this.sessionId});const e=document.createElement("script");e.async=!0,e.src=`https://www.googletagmanager.com/gtag/js?id=${encodeURIComponent(this.gaId)}`,e.onload=()=>{this.providers.ga=!0,this.debug&&console.debug("Google Analytics loaded"),this.pageview()},e.onerror=()=>{this.debug&&console.debug("Failed to load Google Analytics script")},document.head.appendChild(e)}catch(e){this.debug&&console.debug("Failed to load Google Analytics:",e)}}loadVercelAnalytics(){if(!this.providers.vercel)try{const e=document.createElement("script");e.defer=!0,e.src="https://va.vercel-scripts.com/v1/script.js",e.dataset.website=window.location.hostname,e.onload=()=>{this.providers.vercel=!0,this.debug&&console.debug("Vercel Analytics loaded")},e.onerror=()=>{this.debug&&console.debug("Failed to load Vercel Analytics")},document.head.appendChild(e)}catch(e){}}processEventQueue(){if(this.consent.analytics&&0!==this.eventQueue.length)for(;this.eventQueue.length>0;){const{event:e,params:t}=this.eventQueue.shift();this.track(e,t)}}pageview(e){const t=e||window.location.pathname,i={page_location:window.location.href,page_path:t,page_title:document.title,session_id:this.sessionId};this.consent.analytics?(this.providers.ga&&window.gtag&&window.gtag("event","page_view",i),this.providers.local&&this.localTracker&&this.localTracker.track("page_view",i)):this.eventQueue.push({event:"page_view",params:i})}track(e,t={}){if(!e)return;const i={...t,session_id:this.sessionId,timestamp:Date.now()};if(!this.consent.analytics)return this.eventQueue.push({event:e,params:i}),void(this.debug&&console.debug("Event queued (no analytics consent):",e));this.providers.ga&&window.gtag&&window.gtag("event",e,i),this.providers.local&&this.localTracker&&this.localTracker.track(e,i)}isEnabled(){return this.consent.analytics}getSessionId(){return this.sessionId}clearQueue(){this.eventQueue=[]}getProviderStatus(){return{...this.providers}}trackClick(e,t="engagement"){this.track("click",{event_category:t,event_label:e})}trackScroll(e){this.track("scroll",{event_category:"engagement",scroll_percentage:Math.round(e)})}trackTiming(e,t,i,s){this.track("timing_complete",{event_category:e,name:t,value:Math.round(i),event_label:s})}trackError(e,t=!1){this.track("exception",{description:e.message||e,fatal:t})}}({endpoint:"/api/analytics",debug:window.CONFIG?.DEBUG||!1});window.addEventListener("consentChanged",t=>{t.detail&&e.setConsent(t.detail)})}();